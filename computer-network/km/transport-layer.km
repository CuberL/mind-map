{"root":{"data":{"id":"824c8707249b","created":1491576887,"text":"运输层","priority":null},"children":[{"data":{"id":"bbynvwublsoc","created":1491576909939,"text":"TCP","expandState":"expand","hyperlink":"http://www.cnblogs.com/vamei/archive/2012/12/08/2805252.html","hyperlinkTitle":"","layout":null},"children":[{"data":{"id":"bbyoqdcqjw0s","created":1491579296806,"text":"基本概念","layout":null},"children":[{"data":{"id":"bbyoqq31bvcc","created":1491579324518,"text":"TCP面向连接的可靠传输协议","layout":null},"children":[]},{"data":{"id":"bbyoqwqsevk8","created":1491579339015,"text":"TCP提供的全双工服务","layout":null},"children":[]},{"data":{"id":"bbyor06rfogk","created":1491579346511,"text":"建立需要三次握手，断开需要四次挥手","layout":null},"children":[]}]},{"data":{"id":"bbynx00unz4k","created":1491576995229,"text":"可靠传输","expandState":"expand","layout":null},"children":[{"data":{"id":"bbyp0466eq04","created":1491580060460,"text":"为什么需要TCP来实现可靠传输？因为因特网的网络层服务IP层不可靠，是一种尽力而为的服务，不对数据的到达和有序做任何保证","hyperlink":"http://www.cnblogs.com/vamei/archive/2012/12/02/2796988.html","hyperlinkTitle":"","layout":null},"children":[]},{"data":{"id":"bbyp0yi2ko0k","created":1491580126483,"text":"超时重传","expandState":"expand","layout":null},"children":[{"data":{"id":"bbypktun7g8w","created":1491581683642,"text":"RTT的估算，使用指数加权移动平均","layout":null},"children":[]},{"data":{"id":"bbyplkweg88o","created":1491581742522,"text":"同时还估算RTT的变化量","layout":null},"children":[]},{"data":{"id":"bbypm0rbqxsg","created":1491581777043,"text":"超时时间间隔为: 估算RTT+4×估算RTT变化量，推荐初始值为1秒[RFC 6298]","layout":null},"children":[]},{"data":{"id":"bbyptt8b4zk0","created":1491582387569,"text":"超时间隔加倍: 不使用估算RTT和估算RTT变化量计算，而是把上次计算的量翻倍，是一定意义上的拥塞控制","layout":null},"children":[]}]},{"data":{"id":"bbyr3g3zs9sg","created":1491585963762,"text":"累计确认"},"children":[{"data":{"id":"bbyr3kd7mqog","created":1491585973026,"text":"确认号: 在确认号前的字节都被接收并确认后才发出该ACK"},"children":[]},{"data":{"id":"bbyr3xvtpi0c","created":1491586002450,"text":"等待: 发出ACK前会故意延迟一段时间，如果有后续需要确认的可以一起回复"},"children":[]}]},{"data":{"id":"bbypt1v1374s","created":1491582327993,"text":"快速重传:  收到三个冗余ACK，说明有报文段缺失，则快速重传","layout":null},"children":[]},{"data":{"id":"bbypw795k204","created":1491582574825,"text":"流水线差错恢复","layout":null},"children":[{"data":{"id":"bbypweil6mo8","created":1491582590632,"text":"回退N步: 正确接收但失序的报文段不会被逐个确认","layout":null},"children":[]},{"data":{"id":"bbypxh8grugw","created":1491582674914,"text":"选择重传: 部分TCP实现有选择确认，可以确认一定范围内失序的报文段","priority":null,"layout":null},"children":[]}]}]},{"data":{"id":"bbynx72htdcs","created":1491577010565,"text":"流量控制","layout":null},"children":[{"data":{"id":"bbyryoro57kk","created":1491588411897,"text":"出现问题: 接收方读取数据速度和发送方发送数据速度差距过大，可能会使接收方缓存溢出"},"children":[]},{"data":{"id":"bbyrzlp3bl4o","created":1491588483575,"text":"解决问题: 让发送方维护一个接受窗口变量(rwnd)，是接收方给发送方的指示，表明还有多少缓存空间"},"children":[]},{"data":{"id":"bbys1in4uu8g","created":1491588633654,"text":"rwnd=0的情况下，如果接收方不发送数据给发送方，则发送方被阻塞。解决办法是当rwnd=0，继续发送一个字节的报文段，接收方可以在确认报文中附上新的rwnd值"},"children":[]}]},{"data":{"id":"bbynx2vokm0c","created":1491577001446,"text":"拥塞控制","hyperlink":null,"hyperlinkTitle":null,"layout":null},"children":[{"data":{"id":"bbys35cixhc0","created":1491588761443,"text":"出现问题: 当网络变得拥塞时，路由器缓存出现溢出而丢包，所以需要一些机制遏制发送方以过高速度发送数据"},"children":[]},{"data":{"id":"bbys4majjdkc","created":1491588876693,"text":"解决问题"},"children":[{"data":{"id":"bbys5lk73q8k","created":1491588953464,"text":"限制发送速率"},"children":[{"data":{"id":"bbys6jex6uos","created":1491589027155,"text":"维护一个变量即拥塞窗口(cwnd)，对一个TCP发送方的发送流量进行限制。"},"children":[]},{"data":{"id":"bbys77l4kf4k","created":1491589079773,"text":"未确认的数据量不得超过cwnd和rwnd中较小的值"},"children":[]}]},{"data":{"id":"bbys5u5gx8w8","created":1491588972164,"text":"感知网络拥塞"},"children":[{"data":{"id":"bbys87r6fa8k","created":1491589158503,"text":"监测到丢包事件就认为是拥塞的指示"},"children":[{"data":{"id":"bbys9321zzco","created":1491589226641,"text":"出现三次冗余ACK"},"children":[]},{"data":{"id":"bbys974ide88","created":1491589235497,"text":"出现超时"},"children":[]}]}]},{"data":{"id":"bbys5ywcpkgs","created":1491588982497,"text":"确定发送速率"},"children":[{"data":{"id":"bbysa2lez8gg","created":1491589303999,"text":"矛盾"},"children":[{"data":{"id":"bbysb0zebsow","created":1491589378855,"text":"发送太慢不能充分利用带宽"},"children":[]},{"data":{"id":"bbysb8q1xigo","created":1491589395705,"text":"发送太快导致网络拥塞崩溃"},"children":[]}]},{"data":{"id":"bbysc1jurgo4","created":1491589458457,"text":"指导性原则"},"children":[{"data":{"id":"bbysc98f5p4c","created":1491589475179,"text":"丢失的报文段意味着拥塞，应该降低发送方速率"},"children":[]},{"data":{"id":"bbyscfqao1cs","created":1491589489321,"text":"确认报文表示一切顺利，可以提高发送方速率"},"children":[]},{"data":{"id":"bbysczs1hlsk","created":1491589532962,"text":"带宽探测: 通过ACK和丢包事件这些隐式信号进行调整"},"children":[]}]},{"data":{"id":"bbyse5bf2owg","created":1491589623382,"text":"TCP拥塞控制算法"},"children":[{"data":{"id":"bbysec7n04oo","created":1491589638391,"text":"慢启动"},"children":[{"data":{"id":"bbysh0r9vuw4","created":1491589848549,"text":"起始值: cwnd=1MSS"},"children":[]},{"data":{"id":"bbysha5z560o","created":1491589869029,"text":"每当收到一个ACK，cwnd加1个MSS"},"children":[]},{"data":{"id":"bbyshltnht4o","created":1491589894405,"text":"当收到一个丢包事件时，记录一个慢启动阈值ssthresh=cwnd/2，并重新把cwnd置为1MSS"},"children":[]},{"data":{"id":"bbysiazknvkk","created":1491589949183,"text":"当后面到达ssthresh时，再翻倍就可能再次陷入拥塞状态，便结束慢启动，转入拥塞避免模式，更加谨慎地增加cwnd"},"children":[]}]},{"data":{"id":"bbysei04t6w4","created":1491589650998,"text":"拥塞避免"},"children":[{"data":{"id":"bbysj9prixsg","created":1491590024777,"text":"每个RTT增加一个MSS，即每收到一个ACK增加一个(MSS/cwnd)MSS"},"children":[]},{"data":{"id":"bbysp27ed4w0","created":1491590478614,"text":"收到一个丢包事件时"},"children":[{"data":{"id":"bbysrifwlnkk","created":1491590670686,"text":"超时: 同慢启动，更新ssthresh，cwnd设置成1MSS"},"children":[]},{"data":{"id":"bbyssbj6e0gs","created":1491590734010,"text":"冗余ACK: 将ssthresh设置为cwnd的一半,然后将cwnd减半，并加上3个MSS"},"children":[]}]}]},{"data":{"id":"bbysekbm7280","created":1491589656046,"text":"快速恢复(非强制部分)"},"children":[]}]}]}]}]},{"data":{"id":"bbyo3gfb97cc","created":1491577501117,"text":"报文格式","layout":null},"children":[{"data":{"id":"bbyos63fflkw","created":1491579437734,"text":"源端口号、目的端口号(32位)","layout":null},"children":[]},{"data":{"id":"bbyosdyjzqgo","created":1491579454854,"text":"序号(32位): 报文段的序号，是该报文段的首字节的字节流编号","layout":null},"children":[]},{"data":{"id":"bbyosogtqu8g","created":1491579477726,"text":"确认号(32位): 即等待的字节编号，相当于确认了该编号之前的所有报文","layout":null},"children":[]},{"data":{"id":"bbyossa0m4o4","created":1491579486022,"text":"首部长度(4位): 首部是可变的，典型长度为20字节","layout":null},"children":[]},{"data":{"id":"bbyot3c9fww8","created":1491579510102,"text":"标志字段(6位)","layout":null},"children":[{"data":{"id":"bbyoub9kylcg","created":1491579605719,"text":"ACK: 确认报文段被成功接收","layout":null},"children":[]},{"data":{"id":"bbyoucvnmggs","created":1491579609230,"text":"RST: 错误连接复位，也用来拒绝非法请求","layout":null},"children":[]},{"data":{"id":"bbyouetdvqos","created":1491579613446,"text":"SYN: 用于建立连接时，向服务器方请求一个序号","layout":null},"children":[]},{"data":{"id":"bbyouhwdircw","created":1491579620157,"text":"FIN: 用于断开连接时","layout":null},"children":[]},{"data":{"id":"bbyouitu6u0c","created":1491579622181,"text":"PSH: 尽快交付应用层","layout":null},"children":[]},{"data":{"id":"bbyoukfnz808","created":1491579625677,"text":"URG: 紧急报文，次序上优先","layout":null},"children":[]}]},{"data":{"id":"bbyotgmt1hk4","created":1491579539038,"text":"接收窗口字段(16位): 用于流量控制","layout":null},"children":[]}]},{"data":{"id":"bbyr5xebeio0","created":1491586158120,"text":"连接管理"},"children":[{"data":{"id":"bbyr66zslpcg","created":1491586179009,"text":"建立连接"},"children":[{"data":{"id":"bbyr69p5jeo0","created":1491586184896,"text":"第一步: SYN报文段，随机选择一个初始序号，并把SYN置成1"},"children":[]},{"data":{"id":"bbyr6vid3c0k","created":1491586232375,"text":"第二步: SYNACK报文段，服务器回应自己的初始序号，获知客户端的初始序号，并将ACK和SYN置1"},"children":[]},{"data":{"id":"bbyr7id6dr4g","created":1491586282127,"text":"第三步: ACK报文段，对服务器的回应进行确认，该步可以携带客户端到服务器端的实际数据"},"children":[]}]},{"data":{"id":"bbyr8d72fbsc","created":1491586349238,"text":"断开连接(假设客户端主动断开)"},"children":[{"data":{"id":"bbyrol18ypkw","created":1491587620127,"text":"第一步: 客户端向服务器端发送一个FIN报文段"},"children":[{"data":{"id":"bbyrtmcimyw4","created":1491588014806,"text":"客户端: ESTABLISHED -> FIN_WAIT_1"},"children":[]}]},{"data":{"id":"bbyrp2pq2zkg","created":1491587658612,"text":"第二步: 服务器端接收到FIN发出ACK确认"},"children":[{"data":{"id":"bbyru6j0cqgw","created":1491588058734,"text":"服务器端: ESTABLISH -> CLOSE_WAIT"},"children":[]},{"data":{"id":"bbyrul0z61sk","created":1491588090296,"text":"客户端: FIN_WAIT_1 -> FIN_WAIT_2"},"children":[]}]},{"data":{"id":"bbyrpen3ciok","created":1491587684575,"text":"第三步: 服务器端发出自己的FIN报文段"},"children":[{"data":{"id":"bbyrv1ntczk0","created":1491588126505,"text":"服务器端: CLOSE_WAIT -> LAST_ACK"},"children":[]}]},{"data":{"id":"bbyrq16insgs","created":1491587733639,"text":"第四步: 客户端发送ACK确认","expandState":"expand"},"children":[{"data":{"id":"bbyrvb2x394w","created":1491588147010,"text":"客户端: FIN_WAIT_2 -> TIME_WAIT -> CLOSED"},"children":[]},{"data":{"id":"bbyrvw6acrkg","created":1491588192926,"text":"服务器端: LAST_ACK -> CLOSED"},"children":[]}]}]}]},{"data":{"id":"bbyt98dvye8g","created":1491592059351,"text":"常见应用"},"children":[{"data":{"id":"bbyt9dkjylcg","created":1491592070638,"text":"SMTP"},"children":[]},{"data":{"id":"bbyt9ntz6io0","created":1491592092975,"text":"HTTP"},"children":[]},{"data":{"id":"bbyt9vj9jsow","created":1491592109742,"text":"FTP"},"children":[]}]}]},{"data":{"id":"bbynvzthiooc","created":1491576916419,"text":"UDP","hyperlink":"http://www.cnblogs.com/vamei/archive/2012/12/05/2798208.html","hyperlinkTitle":"","layout":null},"children":[{"data":{"id":"bbyt66a3ndsg","created":1491591819676,"text":"基本概念"},"children":[{"data":{"id":"bbyt6bo7nfkk","created":1491591831413,"text":"无需建立连接"},"children":[]},{"data":{"id":"bbyt6klkxts0","created":1491591850845,"text":"无连接状态"},"children":[]},{"data":{"id":"bbyt6rmojxcg","created":1491591866149,"text":"分组首部开销小"},"children":[]}]},{"data":{"id":"bbynwdbziko4","created":1491576945836,"text":"报文格式","note":null,"layout":null},"children":[{"data":{"id":"bbyt3ydsg944","created":1491591645757,"text":"源端口号、目标端口号(32位)"},"children":[]},{"data":{"id":"bbyt4fxt6owg","created":1491591683972,"text":"长度(16位)"},"children":[]},{"data":{"id":"bbyt4u2e0tck","created":1491591714724,"text":"校验和(16位)"},"children":[]}]},{"data":{"id":"bbyt57ks0y88","created":1491591744135,"text":"常见应用"},"children":[{"data":{"id":"bbyt5b14szcw","created":1491591751653,"text":"NFS"},"children":[]},{"data":{"id":"bbyt5fi0k7c4","created":1491591761381,"text":"SNMP"},"children":[]},{"data":{"id":"bbyt5kygpa80","created":1491591773260,"text":"RIP"},"children":[]},{"data":{"id":"bbyt5rbmsrkg","created":1491591787117,"text":"DNS"},"children":[]}]}]}]},"template":"default","theme":"fresh-blue","version":"1.4.37"}